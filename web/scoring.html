<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>Scoring Intelligence Hub - CVE.ICU</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-W0CE61HN2F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-W0CE61HN2F');
    </script>
    
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="static/images/logo.png">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="static/css/style.css">
    
    <!-- Meta tags for SEO -->
    <meta name="description" content="CVE.ICU provides comprehensive analysis and visualization of Common Vulnerabilities and Exposures (CVE) data from 1999 to present.">
    <meta name="keywords" content="CVE, vulnerabilities, security, analysis, dashboard, cybersecurity">
    <meta name="author" content="CVE.ICU">
    
    <!-- Mobile-specific meta tags -->
    <meta name="theme-color" content="#0d6efd">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="CVE.ICU">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="CVE.ICU - CVE Analysis Dashboard">
    <meta property="og:description" content="Comprehensive CVE analysis and visualization from 1999 to present">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cve.icu">
    <meta property="og:image" content="https://cve.icu/static/images/logo.png">
</head>
<body>
    <!-- Header and Navigation -->
    <header class="header">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img src="static/images/logo.png" alt="CVE.ICU Logo">
                CVE.ICU
            </a>
            
            <nav class="nav">
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="years.html">Yearly Analysis</a></li>
                    <li class="nav-dropdown">
                        <a href="cna-hub.html" class="dropdown-toggle">CNA</a>
                        <ul class="dropdown-menu">
                            <li><a href="cna.html">CNA Intelligence</a></li>
                            <li><a href="data-quality.html">Name Matching</a></li>
                        </ul>
                    </li>
                    <li><a href="cpe.html">CPE</a></li>
                    <li><a href="cwe.html">CWE</a></li>
                    <li class="nav-dropdown">
                        <a href="scoring.html" class="dropdown-toggle">Scoring</a>
                        <ul class="dropdown-menu">
                            <li><a href="cvss.html">CVSS</a></li>
                            <li><a href="epss.html">EPSS</a></li>
                            <li><a href="kev.html">KEV</a></li>
                        </ul>
                    </li>
                    <li><a href="growth.html">Growth</a></li>
                    <li><a href="calendar.html">Calendar</a></li>
                </ul>
                <button class="nav-toggle" aria-label="Toggle navigation">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        
<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}

@media (max-width: 992px) {
    .stats-grid {
        grid-template-columns: repeat(1, 1fr);
    }
}

.scoring-card {
    background: var(--color-bg-content);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-lg);
    padding: 1.5rem;
    transition: transform 0.2s, box-shadow 0.2s;
    height: 100%;
}

.scoring-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--box-shadow-lg);
}

.scoring-card h3 {
    font-size: 1.25rem;
    font-weight: var(--font-weight-semibold);
    margin-bottom: 0;
    color: var(--color-text-primary);
}

.scoring-card .badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    font-weight: var(--font-weight-medium);
}

.scoring-card .big-number {
    font-size: 2.5rem;
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    line-height: 1.2;
    margin: 0.5rem 0 0.25rem 0;
}

.scoring-card .stat-label {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin-bottom: 0.75rem;
}

.scoring-card .description {
    color: var(--color-text-secondary);
    font-size: 0.9rem;
    margin: 0.75rem 0;
    line-height: 1.5;
}

.scoring-card .question {
    font-style: italic;
    color: var(--color-text-secondary);
    font-size: 0.85rem;
    padding: 0.75rem;
    background: var(--color-bg-secondary);
    border-radius: var(--border-radius);
    margin-top: auto;
}

.nav-card {
    display: block;
    text-decoration: none;
    color: inherit;
}

.nav-card:hover {
    text-decoration: none;
    color: inherit;
}

.matrix-cell {
    display: flex;
    align-items: center;
    justify-content: center;
    aspect-ratio: 1;
    border-radius: var(--border-radius);
    font-weight: 600;
    font-size: 0.8rem;
    cursor: pointer;
    transition: transform 0.1s;
}

.matrix-cell:hover {
    transform: scale(1.05);
}

.comparison-table {
    width: 100%;
    border-collapse: collapse;
}

.comparison-table th,
.comparison-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--color-border);
}

.comparison-table th {
    background: var(--color-bg-secondary);
    font-weight: var(--font-weight-semibold);
}
</style>

<!-- Hero Section -->
<div class="page-header mb-4 text-center">
    <h1 class="display-4 mb-2">Scoring Intelligence Hub</h1>
    <p class="text-muted">
        Compare and understand vulnerability scoring systems: CVSS, EPSS, and KEV
    </p>
</div>

<!-- Main Scoring Systems Cards -->
<div class="stats-grid mb-5">
    <!-- CVSS Card -->
    <a href="cvss.html" class="nav-card">
        <div class="scoring-card">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <h3>CVSS</h3>
                <span class="badge bg-primary">Severity</span>
            </div>
            <div class="big-number" id="cvssCount">-</div>
            <div class="stat-label">Scored CVEs</div>
            <p class="description">
                Common Vulnerability Scoring System measures the <strong>severity and impact</strong> of vulnerabilities on a 0-10 scale.
            </p>
            <div class="question">
                ðŸ’¡ "How bad is this vulnerability?"
            </div>
        </div>
    </a>
    
    <!-- EPSS Card -->
    <a href="epss.html" class="nav-card">
        <div class="scoring-card">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <h3>EPSS</h3>
                <span class="badge bg-warning text-dark">Probability</span>
            </div>
            <div class="big-number" id="epssCount">-</div>
            <div class="stat-label">Scored CVEs</div>
            <p class="description">
                Exploit Prediction Scoring System predicts the <strong>likelihood of exploitation</strong> within 30 days.
            </p>
            <div class="question">
                ðŸ’¡ "Will this vulnerability be exploited?"
            </div>
        </div>
    </a>
    
    <!-- KEV Card -->
    <a href="kev.html" class="nav-card">
        <div class="scoring-card">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <h3>KEV</h3>
                <span class="badge bg-danger">Exploited</span>
            </div>
            <div class="big-number" id="kevCount">-</div>
            <div class="stat-label">Known Exploited</div>
            <p class="description">
                CISA's Known Exploited Vulnerabilities catalog lists CVEs <strong>confirmed to be actively exploited</strong>.
            </p>
            <div class="question">
                ðŸ’¡ "Is this vulnerability being exploited now?"
            </div>
        </div>
    </a>
</div>

<!-- Risk Matrix Section -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title mb-0">Risk Matrix: CVSS Ã— EPSS</h3>
        <small class="text-muted">Combining severity (CVSS) with exploitation likelihood (EPSS)</small>
    </div>
    <div class="card-body">
        <div id="riskMatrixContainer" style="position: relative; height: 400px;">
            <canvas id="riskMatrixChart"></canvas>
        </div>
    </div>
</div>

<!-- Comparison Table -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title mb-0">System Comparison</h3>
    </div>
    <div class="card-body">
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Aspect</th>
                    <th>CVSS</th>
                    <th>EPSS</th>
                    <th>KEV</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Purpose</strong></td>
                    <td>Measure severity/impact</td>
                    <td>Predict exploitation probability</td>
                    <td>Confirm active exploitation</td>
                </tr>
                <tr>
                    <td><strong>Scale</strong></td>
                    <td>0.0 - 10.0</td>
                    <td>0.0 - 1.0 (probability)</td>
                    <td>Yes / No (binary)</td>
                </tr>
                <tr>
                    <td><strong>Source</strong></td>
                    <td>NVD / Vendors</td>
                    <td>FIRST.org</td>
                    <td>CISA</td>
                </tr>
                <tr>
                    <td><strong>Update Frequency</strong></td>
                    <td>Per CVE publication</td>
                    <td>Daily</td>
                    <td>As exploits confirmed</td>
                </tr>
                <tr>
                    <td><strong>Coverage</strong></td>
                    <td id="cvssTableCount">-</td>
                    <td id="epssTableCount">-</td>
                    <td id="kevTableCount">-</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Overlap Insights -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="stat-card text-center">
            <div class="stat-number" id="epssKevOverlap">-</div>
            <div class="stat-label">EPSS &amp; KEV</div>
            <small class="text-muted">KEV CVEs with EPSS scores</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card text-center">
            <div class="stat-number" id="highEpssNotKev">-</div>
            <div class="stat-label">High EPSS, Not KEV</div>
            <small class="text-muted">EPSS > 0.5 but not in KEV</small>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card text-center">
            <div class="stat-number" id="kevLowEpss">-</div>
            <div class="stat-label">KEV with Low EPSS</div>
            <small class="text-muted">In KEV but EPSS < 0.1</small>
        </div>
    </div>
</div>

<script src="static/js/chart.min.js"></script>
<script>
// Load scoring comparison data
Promise.all([
    fetch('data/scoring_comparison.json').then(r => r.json()),
    fetch('data/risk_matrix.json').then(r => r.json()),
    fetch('data/epss_analysis.json').then(r => r.json())
]).then(([comparison, matrix, epss]) => {
    // Update system cards
    document.getElementById('cvssCount').textContent = 
        (comparison.systems.cvss.total_scored || 0).toLocaleString();
    document.getElementById('epssCount').textContent = 
        (comparison.systems.epss.total_scored || 0).toLocaleString();
    document.getElementById('kevCount').textContent = 
        (comparison.systems.kev.total_scored || 0).toLocaleString();
    
    // Update comparison table
    document.getElementById('cvssTableCount').textContent = 
        (comparison.systems.cvss.total_scored || 0).toLocaleString() + ' CVEs';
    document.getElementById('epssTableCount').textContent = 
        (comparison.systems.epss.total_scored || 0).toLocaleString() + ' CVEs';
    document.getElementById('kevTableCount').textContent = 
        (comparison.systems.kev.total_scored || 0).toLocaleString() + ' CVEs';
    
    // Update overlap insights
    document.getElementById('epssKevOverlap').textContent = 
        (comparison.overlaps.epss_and_kev || 0).toLocaleString();
    document.getElementById('highEpssNotKev').textContent = 
        (comparison.insights.epss_gt_05_not_kev || 0).toLocaleString();
    document.getElementById('kevLowEpss').textContent = 
        (comparison.insights.kev_with_low_epss || 0).toLocaleString();
    
    // Render Risk Matrix as bubble chart
    renderRiskMatrix(matrix);
    
}).catch(err => {
    console.error('Failed to load scoring data:', err);
});

function renderRiskMatrix(matrix) {
    const ctx = document.getElementById('riskMatrixChart').getContext('2d');
    
    // Map severity to x position
    const severityMap = { 'NONE': 0, 'LOW': 1, 'MEDIUM': 2, 'HIGH': 3, 'CRITICAL': 4 };
    const epssMap = { '0-0.1': 0, '0.1-0.3': 1, '0.3-0.5': 2, '0.5-0.7': 3, '0.7+': 4 };
    
    // Prepare data points
    const dataPoints = [];
    const kevPoints = [];
    let maxCount = 0;
    
    matrix.matrix.forEach(cell => {
        if (cell.count > 0) {
            maxCount = Math.max(maxCount, cell.count);
            dataPoints.push({
                x: severityMap[cell.severity],
                y: epssMap[cell.epss_bucket],
                r: Math.sqrt(cell.count) / 10,  // Scale radius
                count: cell.count,
                kev_count: cell.kev_count,
                label: `${cell.severity} / ${cell.epss_bucket}`
            });
        }
    });
    
    new Chart(ctx, {
        type: 'bubble',
        data: {
            datasets: [{
                label: 'CVE Concentration',
                data: dataPoints.map(p => ({
                    x: p.x,
                    y: p.y,
                    r: Math.max(5, Math.min(40, p.r)),
                    count: p.count,
                    kev_count: p.kev_count
                })),
                backgroundColor: dataPoints.map(p => {
                    // Color based on risk using blues and greys
                    const risk = (p.x + p.y) / 8;
                    if (risk > 0.7) return 'rgba(13, 110, 253, 0.85)';   // Primary blue (highest risk)
                    if (risk > 0.5) return 'rgba(33, 150, 243, 0.75)';   // Medium blue
                    if (risk > 0.3) return 'rgba(100, 181, 246, 0.65)';  // Light blue
                    return 'rgba(158, 158, 158, 0.5)';                    // Grey (lowest risk)
                }),
                borderColor: dataPoints.map(p => {
                    const risk = (p.x + p.y) / 8;
                    if (risk > 0.7) return 'rgba(13, 110, 253, 1)';
                    if (risk > 0.5) return 'rgba(33, 150, 243, 1)';
                    if (risk > 0.3) return 'rgba(100, 181, 246, 1)';
                    return 'rgba(117, 117, 117, 1)';
                }),
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: {
                padding: {
                    left: 10,
                    right: 20,
                    top: 10,
                    bottom: 10
                }
            },
            scales: {
                x: {
                    type: 'linear',
                    position: 'bottom',
                    min: -0.5,
                    max: 4.5,
                    title: {
                        display: true,
                        text: 'CVSS Score',
                        font: {
                            size: 13,
                            weight: '600'
                        },
                        padding: { top: 8 }
                    },
                    afterBuildTicks: function(axis) {
                        axis.ticks = [
                            { value: 0, label: 'NONE' },
                            { value: 1, label: 'LOW' },
                            { value: 2, label: 'MEDIUM' },
                            { value: 3, label: 'HIGH' },
                            { value: 4, label: 'CRITICAL' }
                        ];
                    },
                    ticks: {
                        callback: function(value, index, ticks) {
                            const labels = ['NONE', 'LOW', 'MEDIUM', 'HIGH', 'CRITICAL'];
                            return labels[value] || '';
                        },
                        font: { size: 10 },
                        maxRotation: 0
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.08)',
                        drawTicks: true
                    }
                },
                y: {
                    type: 'linear',
                    min: -0.5,
                    max: 4.5,
                    title: {
                        display: true,
                        text: 'EPSS Score',
                        font: {
                            size: 13,
                            weight: '600'
                        },
                        padding: { bottom: 8 }
                    },
                    afterBuildTicks: function(axis) {
                        axis.ticks = [
                            { value: 0, label: '0-0.1' },
                            { value: 1, label: '0.1-0.3' },
                            { value: 2, label: '0.3-0.5' },
                            { value: 3, label: '0.5-0.7' },
                            { value: 4, label: '0.7+' }
                        ];
                    },
                    ticks: {
                        callback: function(value, index, ticks) {
                            const labels = ['0-0.1', '0.1-0.3', '0.3-0.5', '0.5-0.7', '0.7+'];
                            return labels[value] || '';
                        },
                        font: { size: 10 }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.08)',
                        drawTicks: true
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const data = context.raw;
                            return [
                                `CVEs: ${data.count.toLocaleString()}`,
                                `KEV: ${data.kev_count.toLocaleString()}`
                            ];
                        }
                    }
                }
            }
        }
    });
}
</script>


    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div style="display: flex; flex-wrap: wrap; gap: 2rem; justify-content: space-between;">
                <div style="flex: 1; min-width: 200px;">
                    <p class="mb-1"><strong>Data Sources:</strong></p>
                    <p class="text-muted small mb-0">
                        <a href="https://nvd.nist.gov/" target="_blank" class="text-decoration-none">National Vulnerability Database (NVD)</a><br>
                        <a href="https://cve.org/" target="_blank" class="text-decoration-none">CVE Program</a><br>
                        Last updated: <span id="lastUpdated">Loading...</span>
                    </p>
                </div>
                <div style="flex: 1; min-width: 200px; text-align: right;">
                    <p class="mb-1"><strong>Platform Links:</strong></p>
                    <p class="text-muted small mb-0">
                        <a href="about.html" class="text-decoration-none">About CVE.ICU</a><br>
                        <a href="https://cnascorecard.org" target="_blank" class="text-decoration-none">CNA Scorecard</a><br>
                        <a href="https://cveforecast.org" target="_blank" class="text-decoration-none">CVE Forecast</a><br>
                        <a href="https://github.com/rogolabs/cve.icu" target="_blank" class="text-decoration-none">GitHub Repository</a>
                    </p>
                </div>
            </div>
            <hr class="my-2">
            <div class="text-center">
                <small class="text-muted">
                    &copy; 2026 CVE.ICU â€¢ Built by <a href="https://rogolabs.net" target="_blank" class="text-decoration-none">RogoLabs</a><br>
                    Data updated every 6 hours â€¢ CVE coverage: 1999-2026
                </small>
            </div>
        </div>
    </footer>

    <!-- Chart.js Library (UMD version) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- D3.js for advanced visualizations -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Universal timestamp loader -->
    <script>
    // Shared request cache to deduplicate JSON fetches within a page load.
    window.CVE_REQUEST_CACHE = window.CVE_REQUEST_CACHE || new Map();
    window.fetchJsonCached = window.fetchJsonCached || function(url, options = {}) {
        const {
            force = false,
            retries = 2,
            timeoutMs = 10000,
            retryDelayMs = 300
        } = options;
        const resolvedUrl = new URL(url, window.location.href).toString();

        if (!force && window.CVE_REQUEST_CACHE.has(resolvedUrl)) {
            return window.CVE_REQUEST_CACHE.get(resolvedUrl);
        }

        const retryableStatuses = new Set([408, 409, 425, 429, 500, 502, 503, 504]);
        const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));
        const isRetryableNetworkError = (error) => {
            if (!error) return false;
            if (error.name === 'AbortError') return true;
            const message = String(error.message || '').toLowerCase();
            return message.includes('networkerror') || message.includes('failed to fetch');
        };
        const doFetch = async (attempt = 0) => {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeoutMs);

            try {
                const response = await fetch(resolvedUrl, { signal: controller.signal });
                if (!response.ok) {
                    const error = new Error(`HTTP error ${response.status} for ${resolvedUrl}`);
                    error.status = response.status;
                    throw error;
                }
                return await response.json();
            } catch (error) {
                const status = typeof error.status === 'number' ? error.status : null;
                const canRetry = attempt < retries && (
                    isRetryableNetworkError(error) ||
                    (status !== null && retryableStatuses.has(status))
                );

                if (!canRetry) {
                    throw error;
                }

                const backoffMs = retryDelayMs * Math.pow(2, attempt);
                await wait(backoffMs);
                return doFetch(attempt + 1);
            } finally {
                clearTimeout(timeoutId);
            }
        };

        const request = doFetch();

        // Remove failed entries so retries can recover.
        const cachedRequest = request.catch(error => {
            window.CVE_REQUEST_CACHE.delete(resolvedUrl);
            throw error;
        });

        if (!force) {
            window.CVE_REQUEST_CACHE.set(resolvedUrl, cachedRequest);
        }
        return cachedRequest;
    };

    // Universal function to load and display the last updated timestamp
    // Uses cve_all.json as the single source of truth for all pages
    function loadUniversalTimestamp() {
        const lastUpdatedElement = document.getElementById('lastUpdated');
        if (!lastUpdatedElement) return;
        
        window.fetchJsonCached('data/cve_all.json')
            .then(data => {
                if (data.generated_at) {
                    const date = new Date(data.generated_at);
                    const options = {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: false, // Use 24-hour clock
                        timeZone: 'UTC', // Always show UTC
                        timeZoneName: 'short'
                    };
                    const formattedDate = date.toLocaleString('en-US', options);
                    lastUpdatedElement.textContent = formattedDate;
                } else {
                    lastUpdatedElement.textContent = 'Unknown';
                }
            })
            .catch(error => {
                console.error('Error loading timestamp:', error);
                lastUpdatedElement.textContent = 'Error loading timestamp';
            });
    }
    
    // Load timestamp when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        loadUniversalTimestamp();
    });
    </script>
    
    <!-- Mobile Navigation Enhancement -->
    <script>
        // Enhanced mobile navigation toggle
        document.addEventListener('DOMContentLoaded', function() {
            const navToggle = document.querySelector('.nav-toggle');
            const navMenu = document.querySelector('.nav-menu');
            
            if (navToggle && navMenu) {
                navToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    
                    // Prevent body scroll when menu is open
                    if (navMenu.classList.contains('active')) {
                        document.body.style.overflow = 'hidden';
                    } else {
                        document.body.style.overflow = '';
                    }
                });
                
                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    const isClickInside = navToggle.contains(event.target) || navMenu.contains(event.target);
                    
                    if (!isClickInside && navMenu.classList.contains('active')) {
                        navMenu.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
                
                // Close menu when a nav link is clicked
                const navLinks = navMenu.querySelectorAll('a');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        navMenu.classList.remove('active');
                        document.body.style.overflow = '';
                    });
                });
            }
        });
    </script>
    
    <!-- Custom JavaScript -->
    <script>
        // Wait for Chart.js to load before configuring
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof Chart !== 'undefined') {
                // Global configuration for Chart.js with design system
                Chart.defaults.responsive = true;
                Chart.defaults.maintainAspectRatio = false;
                Chart.defaults.plugins.legend.position = 'top';
                Chart.defaults.plugins.legend.labels.usePointStyle = true;
                Chart.defaults.plugins.legend.labels.padding = 20;
                Chart.defaults.plugins.legend.labels.font = {
                    family: 'Inter, sans-serif',
                    size: 12,
                    weight: '500'
                };
                Chart.defaults.plugins.title.display = true;
                Chart.defaults.plugins.title.font = {
                    family: 'Inter, sans-serif',
                    size: 16,
                    weight: '600'
                };
                Chart.defaults.plugins.title.color = '#212529';
                Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(255, 255, 255, 0.95)';
                Chart.defaults.plugins.tooltip.titleColor = '#212529';
                Chart.defaults.plugins.tooltip.bodyColor = '#6c757d';
                Chart.defaults.plugins.tooltip.borderColor = '#dee2e6';
                Chart.defaults.plugins.tooltip.borderWidth = 1;
                Chart.defaults.plugins.tooltip.cornerRadius = 8;
                Chart.defaults.plugins.tooltip.titleFont = {
                    family: 'Inter, sans-serif',
                    size: 13,
                    weight: '600'
                };
                Chart.defaults.plugins.tooltip.bodyFont = {
                    family: 'Inter, sans-serif',
                    size: 12,
                    weight: '400'
                };
                // Chart.js v4 scale configuration
                Chart.defaults.elements.point.backgroundColor = '#2196f3';
                Chart.defaults.elements.point.borderColor = '#2196f3';
                Chart.defaults.elements.line.borderColor = '#2196f3';
                Chart.defaults.elements.bar.backgroundColor = '#2196f3';
                
                // Note: Scale-specific defaults are set per chart type in Chart.js v4
                // Global scale defaults are handled differently
            }
            
            // Add active class to current page navigation link
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            const navLinks = document.querySelectorAll('.nav-menu a');
            
            navLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (href === currentPage || (currentPage === '' && href === 'index.html')) {
                    link.classList.add('active');
                }
            });
        });
        
        // Enhanced Color palette for consistent styling (Light Blue to Grey)
        window.CVE_COLORS = window.CVE_COLORS || {
            primary: '#2196f3',
            secondary: '#64b5f6', 
            success: '#81c784',
            warning: '#ffb74d',
            danger: '#f06292',
            light: '#f8f9fa',
            dark: '#212529',
            
            // Light Blue to Grey Visualization Palette
            vizColors: [
                '#e3f2fd', // Very light blue
                '#bbdefb', // Light blue
                '#90caf9', // Medium light blue
                '#64b5f6', // Medium blue
                '#42a5f5', // Blue
                '#2196f3', // Primary blue
                '#1e88e5', // Darker blue
                '#1976d2', // Dark blue
                '#9e9e9e', // Medium grey
                '#757575'  // Dark grey
            ],
            
            // Chart-specific colors
            chartColors: [
                '#2196f3', // Primary blue
                '#64b5f6', // Secondary blue
                '#90caf9', // Tertiary blue
                '#bbdefb', // Quaternary blue
                '#81c784', // Accent green
                '#ffb74d', // Accent orange
                '#f06292', // Accent pink
                '#e0e0e0', // Light grey
                '#9e9e9e', // Medium grey
                '#616161'  // Dark grey
            ],
            
            // Gradient colors for backgrounds
            gradients: {
                primary: 'linear-gradient(135deg, #e3f2fd, #bbdefb)',
                secondary: 'linear-gradient(135deg, #bbdefb, #90caf9)',
                tertiary: 'linear-gradient(135deg, #90caf9, #64b5f6)'
            }
        };
        
        // Enhanced utility function to generate colors for charts
        function getChartColors(count, type = 'chart') {
            const colors = [];
            const palette = type === 'viz' ? CVE_COLORS.vizColors : CVE_COLORS.chartColors;
            
            for (let i = 0; i < count; i++) {
                colors.push(palette[i % palette.length]);
            }
            return colors;
        }
        
        // Generate light blue to grey gradient colors
        function getGradientColors(count) {
            const colors = [];
            for (let i = 0; i < count; i++) {
                const ratio = i / Math.max(count - 1, 1);
                // Interpolate between light blue and grey
                const r = Math.round(227 + (158 - 227) * ratio); // e3 to 9e
                const g = Math.round(242 + (158 - 242) * ratio); // f2 to 9e
                const b = Math.round(253 + (158 - 253) * ratio); // fd to 9e
                colors.push(`rgb(${r}, ${g}, ${b})`);
            }
            return colors;
        }
        
        // Get color with opacity
        function getColorWithOpacity(color, opacity = 0.8) {
            if (color.startsWith('#')) {
                const r = parseInt(color.slice(1, 3), 16);
                const g = parseInt(color.slice(3, 5), 16);
                const b = parseInt(color.slice(5, 7), 16);
                return `rgba(${r}, ${g}, ${b}, ${opacity})`;
            }
            return color;
        }
        
        // Utility function to format numbers
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        // Utility function to show loading state
        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = '<div class="loading"><div class="spinner"></div>Loading data...</div>';
            }
        }
        
        // Utility function to hide loading state
        function hideLoading(containerId) {
            const container = document.getElementById(containerId);
            if (container) {
                const loading = container.querySelector('.loading');
                if (loading) {
                    loading.remove();
                }
            }
        }
        
        // Get current year for dynamic functionality
        const CURRENT_YEAR = new Date().getFullYear();
        const AVAILABLE_YEARS = [];
        for (let year = 1999; year <= CURRENT_YEAR; year++) {
            AVAILABLE_YEARS.push(year);
        }
        
        // Mobile table enhancement - add touch scroll indicators
        function enhanceMobileTable(tableContainer) {
            if (window.innerWidth <= 768 && tableContainer) {
                const table = tableContainer.querySelector('table');
                if (table && table.scrollWidth > tableContainer.clientWidth) {
                    tableContainer.style.overflowX = 'auto';
                    tableContainer.style.webkitOverflowScrolling = 'touch';
                    
                    // Add scroll shadow indicators
                    tableContainer.addEventListener('scroll', function() {
                        const scrollLeft = this.scrollLeft;
                        const maxScroll = this.scrollWidth - this.clientWidth;
                        
                        if (scrollLeft > 0) {
                            this.classList.add('scrolled-left');
                        } else {
                            this.classList.remove('scrolled-left');
                        }
                        
                        if (scrollLeft < maxScroll - 1) {
                            this.classList.add('scrolled-right');
                        } else {
                            this.classList.remove('scrolled-right');
                        }
                    });
                }
            }
        }
        
        // Apply mobile table enhancements on load
        document.addEventListener('DOMContentLoaded', function() {
            const tableContainers = document.querySelectorAll('.table-container');
            tableContainers.forEach(enhanceMobileTable);
            
            // Re-apply on window resize
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    tableContainers.forEach(enhanceMobileTable);
                }, 250);
            });
        });
    </script>
    
    
    <!-- Page-specific JavaScript will be inserted here -->
    
</body>
</html>